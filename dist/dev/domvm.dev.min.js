// https://github.com/leeoniya/domvm (3.x-dev, dev build)

!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.domvm=t()}(this,function(){"use strict";function e(){}function t(e){return null!=e&&e.constructor===Object}function n(e,t,n,l){e.splice.apply(e,[n,l].concat(t))}function l(e){return"function"==typeof e}function r(e){for(var t=arguments,n=1;n<t.length;n++)for(var l in t[n])e[l]=t[n][l];return e}function o(e,t){for(var n=[],l=t;l<e.length;l++)n.push(e[l]);return n}function i(e,t){for(var n in e)if(e[n]!==t[n])return!1;return!0}function a(e,t){var n=e.length;if(t.length!==n)return!1;for(var l=0;l<n;l++)if(e[l]!==t[l])return!1;return!0}function u(e){function t(){n=0,e.apply(l,r)}if(!we)return e;var n,l,r;return function(){l=this,r=arguments,n||(n=we(t))}}function s(e){return"o"===e[0]&&"n"===e[1]}function f(e){return"_"===e[0]}function d(e){return"style"===e}function c(e){e&&e.el&&e.el.offsetHeight}function h(e){return null!=e.node&&null!=e.node.el}function v(e,t){switch(t){case"value":case"checked":case"selected":return!0}return!1}function y(e){for(e=e||ke;null==e.vm&&e.parent;)e=e.parent;return e.vm}function p(){}function m(e){var t=new p;return t.type=ve,t.body=e,t}function g(e,t){var n=Ne(e,function(e){n&&(null!=t.node&&t.redraw(),De(n))});return Te(e)}function b(e,t){var n=Ne(e,function(e){n&&null!=t.node&&t.redraw()});return n}function _(e,t){if(Se.warnings&&l(Se[e])){var n=Se[e].apply(null,t);n&&(n[0]=e+": "+(Se.verbose?n[0]:""),console.warn.apply(console,n))}}function w(e,t,n,l){var r=new p;r.type=he,r.flags=l||0,r.attrs=t||null;var o=function(e){var t=Re[e];if(null==t){var n,l,r,o;for(Re[e]=t={tag:(n=e.match(/^[-\w]+/))?n[0]:"div",id:(l=e.match(/#([-\w]+)/))?l[1]:null,class:(r=e.match(/\.([-\w.]+)/))?r[1].replace(/\./g," "):null,attrs:null};o=Ce.exec(e);)null==t.attrs&&(t.attrs={}),t.attrs[o[1]]=o[2]||""}return t}(e);r.tag=o.tag;var i=null!=o.id,a=null!=o.class,u=null!=o.attrs;if(i||a||u){var s=r.attrs||{};if(i&&null==s.id&&(s.id=o.id),a&&(r._class=o.class,s.class=o.class+(null!=s.class?" "+s.class:"")),u)for(var f in o.attrs)null==s[f]&&(s[f]=o.attrs[f]);r.attrs=s}var d=r.attrs;return null!=d&&(null!=d._key&&(r.key=d._key),null!=d._ref&&(r.ref=d._ref),null!=d._hooks&&(r.hooks=d._hooks),null!=d._data&&(r.data=d._data),null!=d._flags&&(r.flags=d._flags),null==r.key&&(null!=r.ref?r.key=r.ref:null!=d.id?r.key=d.id:null!=d.name&&(r.key=d.name+("radio"===d.type||"checkbox"===d.type?d.value:"")))),null!=n&&(r.body=n),"svg"===r.tag?setTimeout(function(){null==r.ns&&_("SVG_WRONG_FACTORY",[r])},16):/^(?:input|textarea|select|datalist|keygen|output)$/.test(r.tag)&&null==r.key&&_("UNKEYED_INPUT",[r]),r}function k(e,t,l,r){if(e.type!==me&&e.type!==pe){e.parent=t,e.idx=l,e.vm=r,null!=e.ref&&function(e,t,n){!function(e,t,n){for(var l;l=t.shift();)0===t.length?e[l]=n:e[l]=e=e[l]||{}}(e,["refs"].concat(t.split(".")),n)}(y(e),e.ref,e);var o=e.hooks,i=r&&r.hooks;(o&&(o.willRemove||o.didRemove)||i&&(i.willUnmount||i.didUnmount))&&function(e){for(;e=e.parent;)e.flags|=Me}(e),Ee(e.body)?function(e){for(var t=e.body,l=0;l<t.length;l++){var r=t[l];!1===r||null==r?t.splice(l--,1):Ee(r)?(0!==l&&l!==t.length-1||_("ARRAY_FLATTENED",[e,r]),n(t,r,l--,1)):(null==r.type&&(t[l]=r=m(""+r)),r.type===ve?null==r.body||""===r.body?t.splice(l--,1):l>0&&t[l-1].type===ve?(_("ADJACENT_TEXT",[e,t[l-1].body,r.body]),t[l-1].body+=r.body,t.splice(l--,1)):k(r,e,l,null):k(r,e,l,null))}}(e):""===e.body?e.body=null:Ae(e.body)&&(e.body=g(e.body,y(e)))}}function E(e,t){return isNaN(t)||He[e]?t:t+"px"}function x(e,t){var n=(e.attrs||ke).style,l=t?(t.attrs||ke).style:null;if(null==n||function(e){var t=typeof e;return"string"===t||"number"===t}(n))e.el.style.cssText=n;else{for(var r in n){var o=n[r];Ae(o)&&(o=g(o,y(e))),(null==l||null!=o&&o!==l[r])&&(e.el.style[r]=E(r,o))}if(l)for(var i in l)null==n[i]&&(e.el.style[i]="")}}function A(e,t,n,l,r){if(null!=e){var o=n.hooks[t];if(o){if("d"!==t[0]||"i"!==t[1]||"d"!==t[2])return o(n,l);r?c(n.parent)&&o(n,l):Ye.push([o,n,l])}}}function T(e){if(Ye.length){c(e.node);for(var t;t=Ye.shift();)t[0](t[1],t[2])}}function N(e){return e.nextSibling}function D(e){var t=e.vm,n=null!=t&&A(t.hooks,"willUnmount",t,t.data),l=A(e.hooks,"willRemove",e);if((e.flags&Me)===Me&&Ee(e.body))for(var r=0;r<e.body.length;r++)D(e.body[r]);return n||l}function R(e,t,n){var l=t._node,r=l.vm;if(Ee(l.body))if((l.flags&Me)===Me)for(var o=0;o<l.body.length;o++)R(t,l.body[o].el);else S(l);delete t._node,e.removeChild(t),A(l.hooks,"didRemove",l,null,n),null!=r&&(A(r.hooks,"didUnmount",r,r.data,n),r.node=null)}function C(e,t){var n=t._node;if(!n._dead){var r=D(n);null!=r&&function(e){return"object"==typeof e&&l(e.then)}(r)?(n._dead=!0,r.then(function(e,t,n){return function(){return e.apply(n,t)}}(R,[e,t,!0]))):R(e,t)}}function S(e){for(var t=e.body,n=0;n<t.length;n++){var l=t[n];delete l.el._node,null!=l.vm&&(l.vm.node=null),Ee(l.body)&&S(l)}}function M(e){var t=e.el;if(0==(e.flags&Me))Ee(e.body)&&S(e),t.textContent=null;else{var n=t.firstChild;do{var l=N(n);C(t,n)}while(n=l)}}function L(e,t,n){var l=t._node,r=null!=t.parentNode,o=t!==n&&r?null:l.vm;null!=o&&A(o.hooks,"willMount",o,o.data),A(l.hooks,r?"willReinsert":"willInsert",l),e.insertBefore(t,n),A(l.hooks,r?"didReinsert":"didInsert",l),null!=o&&A(o.hooks,"didMount",o,o.data)}function I(e,t,n){L(e,t,n?N(n):null)}function O(e,t,n){e[t]=n}function H(e,t,n,l,r){var o=e.apply(r,t.concat([n,l,r,r.data]));r.onevent(n,l,r,r.data,t),Ve.call(null,n,l,r,r.data,t),!1===o&&(n.preventDefault(),n.stopPropagation())}function Y(e){var t,n,l=function(e){for(;null==e._node;)e=e.parentNode;return e._node}(e.target),r=y(l),o=e.currentTarget._node.attrs["on"+e.type];if(Ee(o))H(t=o[0],n=o.slice(1),e,l,r);else for(var i in o)if(e.target.matches(i)){var a=o[i];Ee(a)?(t=a[0],n=a.slice(1)):(t=a,n=[]),H(t,n,e,l,r)}}function U(e,n,r,o){if(r!==o){l(r)&&l(o)&&o.name==r.name&&_("INLINE_HANDLER",[e,o,r]),null==o||null==r||Ee(o)==Ee(r)&&t(o)==t(r)&&l(o)==l(r)||_("MISMATCHED_HANDLER",[e,o,r]);var i=e.el;null==r||l(r)?O(i,n,r):null==o&&O(i,n,Y)}}function V(e,t,n){"."===t[0]&&(t=t.substr(1),n=!0),n?e.el[t]="":e.el.removeAttribute(t)}function j(e,t,n,l,r){var o=e.el;null!=e.ns?o.setAttribute(t,n):"class"===t?o.className=n:"id"===t||"boolean"==typeof n||l?o[t]=n:"."===t[0]?o[t.substr(1)]=n:o.setAttribute(t,n)}function F(e,t,n){var l=e.attrs||ke,r=t.attrs||ke;if(l===r)_("REUSED_ATTRS",[e]);else{for(var o in l){var i=l[o];if(null!=i){var a=v(e.tag,o),u=a?e.el[o]:r[o];Ae(i)&&(l[o]=i=g(i,y(e))),i===u||(d(o)?x(e,t):f(o)||(s(o)?U(e,o,i,u):j(e,o,i,a)))}}for(var o in r)null==l[o]&&!f(o)&&V(e,o,v(e.tag,o)||s(o))}}function P(e,t,n,l){return e.type===pe&&(t=e.data,n=e.key,l=e.opts,e=e.view),new Z(e,t,n,l)}function G(e){for(var t=0;t<e.body.length;t++){var n=e.body[t],l=n.type;if(l<=ye)L(e.el,W(n));else if(l===pe){l=(r=P(n.view,n.data,n.key,n.opts)._redraw(e,t,!1)).node.type,L(e.el,W(r.node))}else if(l===me){var r;(r=n.vm)._redraw(e,t),l=r.node.type,L(e.el,r.node.el)}}}function W(e,t){return null==e.el&&(e.type===he?(e.el=t||function(e,t){return null!=t?_e.createElementNS(t,e):_e.createElement(e)}(e.tag,e.ns),null!=e.attrs&&F(e,ke),(e.flags&Oe)===Oe&&e.body.body(e),Ee(e.body)?G(e):null!=e.body&&(e.el.textContent=e.body)):e.type===ve?e.el=t||function(e){return _e.createTextNode(e)}(e.body):e.type===ye&&(e.el=t||function(e){return _e.createComment(e)}(e.body))),e.el._node=e,e.el}function z(e,t,n,l,r,o,i,a){return function(u,s,f,d,c,h){var v,y;if(null!=d[l]){if(null==(v=d[l]._node))return _("FOREIGN_ELEMENT",[d[l]]),void(d[l]=e(d[l]));if(function(e){return e.parent}(v)!==u)return y=e(d[l]),null!=v.vm?v.vm.unmount(!0):C(s,d[l]),void(d[l]=y)}if(d[r]==c)return Fe;if(null==d[r].el)n(s,W(d[r]),d[l]),d[r]=t(d[r],f);else if(d[r].el===d[l])d[r]=t(d[r],f),d[l]=e(d[l]);else{if(h||v!==d[i])return null!=d[r].vm&&_("ALREADY_HYDRATED",[d[r].vm]),h&&null!=d[l]?function(e,t,n,l,r,o,i,a,u){if(a._lis)n(o,u[r].el,u[l]),u[r]=t(u[r],i);else{var s=function(e,t){var n,l=0,r=t.length-1;if(r<=2147483647)for(;l<=r;){if(n=l+r>>1,t[n]===e)return n;t[n]<e?l=n+1:r=n-1}else for(;l<=r;){if(n=Math.floor((l+r)/2),t[n]===e)return n;t[n]<e?l=n+1:r=n-1}return l==t.length?null:l}(a.idx,u.tombs);a._lis=!0;var f=e(u[l]);n(o,u[l],null!=s?i[u.tombs[s]].el:s),null==s?u.tombs.push(a.idx):u.tombs.splice(s,0,a.idx),u[l]=f}}(e,t,n,l,r,s,f,v,d):je;y=d[l],d[l]=e(y),a(s,y,d[o]),d[o]=y}}}function B(e,t){var n=t.body,l=e.el,r=e.body,o={lftNode:r[0],rgtNode:r[r.length-1],lftSib:(n[0]||ke).el,rgtSib:(n[n.length-1]||ke).el};e:for(;;){for(;;){var i=Pe(e,l,r,o,null,!1);if(i===je)break;if(i===Fe)break e}for(;;){var a=Ge(e,l,r,o,o.lftNode,!1);if(a===je)break;if(a===Fe)break e}!function(e,t,n,l){for(var r=Array.prototype.slice.call(t.childNodes),o=[],i=0;i<r.length;i++){var a=r[i]._node;a.parent===e&&o.push(a.idx)}for(var u=function(e){var t=e.slice(),n=[];n.push(0);for(var l,r,o=0,i=e.length;o<i;++o){var a=n[n.length-1];if(e[a]<e[o])t[o]=a,n.push(o);else{for(l=0,r=n.length-1;l<r;){var u=(l+r)/2|0;e[n[u]]<e[o]?l=u+1:r=u}e[o]<e[n[l]]&&(l>0&&(t[o]=n[l-1]),n[l]=o)}}for(r=n[(l=n.length)-1];l-- >0;)n[l]=r,r=t[r];return n}(o).map(function(e){return o[e]}),s=0;s<u.length;s++)n[u[s]]._lis=!0;l.tombs=u;for(;;){var f=Pe(e,t,n,l,null,!0);if(f===Fe)break}}(e,l,r,o);break}}function K(e){return e.el._node.parent!==e.parent}function X(e,t,n){return t[n]}function $(e,t,n){for(;n<t.length;n++){var l=t[n];if(null!=l.vm){if(e.type===pe&&l.vm.view===e.view&&l.vm.key===e.key||e.type===me&&l.vm===e.vm)return l}else if(!K(l)&&e.tag===l.tag&&e.type===l.type&&e.key===l.key&&(e.flags&~Me)==(l.flags&~Me))return l}return null}function q(e,t,n){if(null==t._keys){if(t[n].key===e.key)return t[n];for(var l={},r=0;r<t.length;r++)l[t[r].key]=r;t._keys=l}return t[t._keys[e.key]]}function J(t,n){A(n.hooks,"willRecycle",n,t);var l=t.el=n.el,r=n.body,o=t.body;if(l._node=t,t.type!==ve||o===r){null==t.attrs&&null==n.attrs||F(t,n);var i=Ee(r),a=Ee(o),u=(t.flags&Oe)===Oe;i?a||u?function(t,n){var l=t.body,r=l.length,o=n.body,i=o.length,a=(t.flags&Oe)===Oe,u=(t.flags&Le)===Le,s=(t.flags&Ie)===Ie,f=!u&&t.type===he,d=!0,c=0===i?e:s?q:u||a?X:$;if(f&&0===r)return M(n),void(a&&(t.body=[]));var v,y,p=0,m=!1,g=0;if(a)var b={key:null},_=Array(r);for(var w=0;w<r;w++){if(a){var E=!1,x=null;d&&(s&&(b.key=l.key(w)),v=c(b,o,g)),null!=v?(y=v.idx,!0===(x=l.diff(w,v))?((A=v).parent=t,A.idx=w,A._lis=!1):E=!0):E=!0,E&&(k(A=l.tpl(w),t,w),A._diff=null!=x?x:l.diff(w),null!=v&&J(A,v)),_[w]=A}else{var A=l[w],T=A.type;if(T<=ye)(v=d&&c(A,o,g))&&(J(A,v),y=v.idx);else if(T===pe){if(v=d&&c(A,o,g)){y=v.idx;var N=v.vm._update(A.data,t,w)}else var N=P(A.view,A.data,A.key,A.opts)._redraw(t,w,!1);T=N.node.type}else if(T===me){var D=h(A.vm),N=A.vm._update(A.data,t,w,D);T=N.node.type}}if(null!=v&&(y===g?++g===i&&r>i&&(v=null,d=!1):m=!0,!s&&i>100&&m&&++p%10==0))for(;g<i&&K(o[g]);)g++}a&&(t.body=_);f&&B(t,n)}(t,n):o!==r&&(null!=o?l.textContent=o:M(n)):a?(M(n),G(t)):o!==r&&(null!=o&&null!=r?l.firstChild.nodeValue=o:l.textContent=o),A(n.hooks,"didRecycle",n,t)}else l.nodeValue=o}function Z(e,n,r,o){var i=this;i.view=e,i.data=n,i.key=r,Ae(n)&&(i._stream=b(n,i)),o&&(i.opts=o,i.config(o));var a=t(e)?e:e.call(i,i,n,r,o);l(a)?i.render=a:(i.render=a.render,i.config(a)),i._redrawAsync=u(function(e){return i.redraw(!0)}),i._updateAsync=u(function(e){return i.update(e,!0)}),i.init&&i.init.call(i,i,i.data,i.key,o)}function Q(e,t,n,l){return null!=n&&(n.body[l]=t,t.idx=l,t.parent=n,t._lis=!1),e}function ee(e,n,l,r){var o,i;return null==l?t(n)?o=n:i=n:(o=n,i=l),w(e,o,i,r)}function te(e,t,n,l){this.view=e,this.data=t,this.key=n,this.opts=l}function ne(e){this.vm=e}function le(e,t){var n=e.body;if(Ee(n))for(var l=0;l<n.length;l++){var r=n[l];null!=r.vm?t.push(r.vm):le(r,t)}return t}function re(e){var n,l,r=arguments,i=r.length;if(i>1){var a=1;t(r[1])&&(l=r[1],a=2),n=i!==a+1||r[a]instanceof p||r[a]instanceof te||r[a]instanceof ne?o(r,a):r[a]}return w(e,l,n)}function oe(e,t){e.el=t,t._node=e;var n=e.attrs;for(var l in n){var r=n[l],o=v(e.tag,l);d(l)||f(l)||(s(l)?U(e,l,r):null!=r&&o&&j(e,l,r,o))}if((e.flags&Oe)===Oe&&e.body.body(e),Ee(e.body)&&e.body.length>0){var i=t.firstChild,a=0,u=e.body[a];do{u.type===pe?u=P(u.view,u.data,u.key,u.opts)._redraw(e,a,!1).node:u.type===me&&(u=u.node||u._redraw(e,a,!1).node),"table"===e.tag&&"tr"===u.tag&&_("ATTACH_IMPLICIT_TBODY",[e,u]),oe(u,i)}while((i=i.nextSibling)&&(u=e.body[++a]))}}function ie(e){return e.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function ae(e){var t="";for(var n in e)null!=e[n]&&(t+=ie(n)+": "+E(n,e[n])+"; ");return t}function ue(e){return null==e?"":""+e}function se(e){e=ue(e);for(var t=0,n="";t<e.length;t++)switch(e[t]){case"&":n+="&amp;";break;case"<":n+="&lt;";break;case">":n+="&gt;";break;default:n+=e[t]}return n}function fe(e){e=ue(e);for(var t=0,n="";t<e.length;t++)n+='"'===e[t]?"&quot;":e[t];return n}function de(e,t){for(var n="",l=0;l<e.length;l++)n+=ce(e[l],t);return n}function ce(e,t){var n,l;switch(e.type){case pe:n=P(e.view,e.data,e.key,e.opts).html(t);break;case me:n=e.vm.html();break;case he:if(null!=e.el&&null==e.tag){n=e.el.outerHTML;break}var r="";r+="<"+e.tag;var o=e.attrs,i=null!=o;if(i){for(var a in o)if(!(s(a)||"."===a[0]||"_"===a[0]||!1===t&&v(e.tag,a))){var u=o[a];"style"!==a||null==u?!0===u?r+=" "+se(a)+'=""':!1===u||null!=u&&(r+=" "+se(a)+'="'+fe(u)+'"'):l="object"==typeof u?ae(u):u}null!=l&&(r+=' style="'+fe(l.trim())+'"')}if(null==e.body&&null!=e.ns&&"svg"!==e.tag)return r+"/>";r+=">",Xe[e.tag]||(i&&null!=o[$e]?r+=o[$e]:Ee(e.body)?r+=de(e.body,t):(e.flags&Oe)===Oe?(e.body.body(e),r+=de(e.body,t)):r+=se(e.body),r+="</"+e.tag+">"),n=r;break;case ve:n=se(e.body);break;case ye:n="\x3c!--"+se(e.body)+"--\x3e"}return n}var he=1,ve=2,ye=3,pe=4,me=5,ge="undefined"!=typeof window,be=ge?window:{},_e=ge?document:{},we=be.requestAnimationFrame,ke={},Ee=Array.isArray,xe=p.prototype={constructor:p,type:null,vm:null,key:null,ref:null,data:null,hooks:null,ns:null,el:null,tag:null,attrs:null,body:null,flags:0,_class:null,_diff:null,_dead:!1,_lis:!1,idx:null,parent:null},Ae=function(){return!1},Te=e,Ne=e,De=e,Re={},Ce=/\[(\w+)(?:=(\w+))?\]/g,Se={syncRedraw:!1,warnings:!0,verbose:!0,mutations:!0,DATA_REPLACED:function(e,t,n){if(l(e.view)&&e.view.length>1){return["A view's data was replaced. The data originally passed to the view closure during init is now stale. You may want to rely only on the data passed to render() or vm.data.",e,t,n]}},UNKEYED_INPUT:function(e){return["Unkeyed <input> detected. Consider adding a name, id, _key, or _ref attr to avoid accidental DOM recycling between different <input> types.",e]},UNMOUNTED_REDRAW:function(e){return["Invoking redraw() of an unmounted (sub)view may result in errors.",e]},INLINE_HANDLER:function(e,t,n){return["Anonymous event handlers get re-bound on each redraw, consider defining them outside of templates for better reuse.",e,t,n]},MISMATCHED_HANDLER:function(e,t,n){return["Patching of different event handler styles is not fully supported for performance reasons. Ensure that handlers are defined using the same style.",e,t,n]},SVG_WRONG_FACTORY:function(e){return["<svg> defined using domvm.defineElement. Use domvm.defineSvgElement for <svg> & child nodes.",e]},FOREIGN_ELEMENT:function(e){return["domvm stumbled upon an element in its DOM that it didn't create, which may be problematic. You can inject external elements into the vtree using domvm.injectElement.",e]},REUSED_ATTRS:function(e){return["Attrs objects may only be reused if they are truly static, as a perf optimization. Mutating & reusing them will have no effect on the DOM due to 0 diff.",e]},ADJACENT_TEXT:function(e,t,n){return["Adjacent text nodes will be merged. Consider concatentating them yourself in the template for improved perf.",e,t,n]},ARRAY_FLATTENED:function(e,t){return["Arrays within templates will be flattened. When they are leading or trailing, it's easy and more performant to just .concat() them in the template.",e,t]},ALREADY_HYDRATED:function(e){return["A child view failed to mount because it was already hydrated. Make sure not to invoke vm.redraw() or vm.update() on unmounted views.",e]},ATTACH_IMPLICIT_TBODY:function(e,t){return["<table><tr> was detected in the vtree, but the DOM will be <table><tbody><tr> after HTML's implicit parsing. You should create the <tbody> vnode explicitly to avoid SSR/attach() failures.",e,t]}},Me=1,Le=2,Ie=4,Oe=8,He={animationIterationCount:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridColumn:!0,order:!0,lineClamp:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ye=[],Ue={},Ve=e,je=1,Fe=2,Pe=z(N,function(e,t){return t[e.idx+1]},L,"lftSib","lftNode","rgtSib","rgtNode",I),Ge=z(function(e){return e.previousSibling},function(e,t){return t[e.idx-1]},I,"rgtSib","rgtNode","lftSib","lftNode",L),We=null;Se.mutations&&(We=new function(e){function t(e){for(var t=e.split("."),n=win;t.length>1;)n=n[t.shift()];return{ctx:n,last:t[0]}}navigator.userAgent.indexOf("Edge");var n=-1!==navigator.userAgent.indexOf("Trident/"),l=Object.getOwnPropertyDescriptor,r=Object.defineProperty,o=Node.prototype,i=l(o,"textContent"),a=l(o,"nodeValue"),u=HTMLElement.prototype,s=l(u,"innerText"),f=Element.prototype,d=l(n?u:f,"innerHTML"),c=l(n?u:f,"className"),h=l(n?u:f,"id"),v=CSSStyleDeclaration.prototype,y=l(v,"cssText"),p=HTMLInputElement.prototype,m=HTMLTextAreaElement.prototype,g=HTMLSelectElement.prototype,b=HTMLOptionElement.prototype,_=l(p,"checked"),w=l(p,"value"),k=l(m,"value"),E=l(g,"value"),x=l(g,"selectedIndex"),A=l(b,"selected"),T={"document.createElement":null,"document.createElementNS":null,"document.createTextNode":null,"document.createComment":null,"document.createDocumentFragment":null,"DocumentFragment.prototype.insertBefore":null,"Element.prototype.appendChild":null,"Element.prototype.removeChild":null,"Element.prototype.insertBefore":null,"Element.prototype.replaceChild":null,"Element.prototype.remove":null,"Element.prototype.setAttribute":null,"Element.prototype.setAttributeNS":null,"Element.prototype.removeAttribute":null,"Element.prototype.removeAttributeNS":null},N={},D=null;for(var R in T){var C=t(R);null===T[R]&&(T[R]=C.ctx[C.last]),function(e,t){N[t]=0,C.ctx[t]=function(){return N[t]++,T[e].apply(this,arguments)}}(R,C.last)}N.textContent=0,r(o,"textContent",{set:function(e){N.textContent++,i.set.call(this,e)}}),N.nodeValue=0,r(o,"nodeValue",{set:function(e){N.nodeValue++,a.set.call(this,e)}}),N.innerText=0,r(u,"innerText",{set:function(e){N.innerText++,s.set.call(this,e)}}),N.innerHTML=0,r(n?u:f,"innerHTML",{set:function(e){N.innerHTML++,d.set.call(this,e)}}),N.className=0,r(n?u:f,"className",{set:function(e){N.className++,c.set.call(this,e)}}),N.cssText=0,r(v,"cssText",{set:function(e){N.cssText++,y.set.call(this,e)}}),N.id=0,r(n?u:f,"id",{set:function(e){N.id++,h.set.call(this,e)}}),N.checked=0,r(p,"checked",{set:function(e){N.checked++,_.set.call(this,e)}}),N.value=0,r(p,"value",{set:function(e){N.value++,w.set.call(this,e)}}),r(m,"value",{set:function(e){N.value++,k.set.call(this,e)}}),r(g,"value",{set:function(e){N.value++,E.set.call(this,e)}}),N.selectedIndex=0,r(g,"selectedIndex",{set:function(e){N.selectedIndex++,x.set.call(this,e)}}),N.selected=0,r(b,"selected",{set:function(e){N.selected++,A.set.call(this,e)}}),this.start=function(){D=+new Date},this.end=function(){var t=+new Date-D;D=null;var n={};for(var l in N)N[l]>0&&(n[l]=N[l]);return function(){for(var e in N)N[e]=0}(),e&&(n._time=t),n}}(!0));var ze=Z.prototype={constructor:Z,_diff:null,init:null,view:null,key:null,data:null,state:null,api:null,opts:null,node:null,hooks:null,onevent:e,refs:null,render:null,mount:function(e,t){return Se.mutations&&We.start(),t?(M({el:e,flags:0}),this._redraw(null,null,!1),e.nodeName.toLowerCase()!==this.node.tag?(W(this.node),L(e.parentNode,this.node.el,e),e.parentNode.removeChild(e)):L(e.parentNode,W(this.node,e),e)):(this._redraw(null,null),e&&L(e,this.node.el)),e&&T(this),Se.mutations&&console.log(We.end()),this},unmount:function(e){Ae(this._stream)&&De(this._stream);var t=this.node;C(t.el.parentNode,t.el),e||T(this)},config:function(e){e.init&&(this.init=e.init),e.diff&&(this.diff=e.diff),e.onevent&&(this.onevent=e.onevent),e.hooks&&(this.hooks=r(this.hooks||{},e.hooks)),e.onemit&&(this.onemit=r(this.onemit||{},e.onemit))},parent:function(){return y(this.node.parent)},root:function(){for(var e=this.node;e.parent;)e=e.parent;return e.vm},redraw:function(e){Se.syncRedraw&&(e=!0);return e?this._redraw(null,null,h(this)):this._redrawAsync(),this},update:function(e,t){Se.syncRedraw&&(t=!0);return t?this._update(e,null,null,h(this)):this._updateAsync(e),this},_update:function(e,t,n,l){return null!=e&&this.data!==e&&(_("DATA_REPLACED",[this,this.data,e]),A(this.hooks,"willUpdate",this,e),this.data=e,Ae(this._stream)&&De(this._stream),Ae(e)&&(this._stream=b(e,this))),this._redraw(t,n,l)},_redraw:function(e,t,n){var l=null==e,r=this.node&&this.node.el&&this.node.el.parentNode;l&&this.node&&this.node.el&&!this.node.el.parentNode&&_("UNMOUNTED_REDRAW",[this]),l&&Se.mutations&&r&&We.start();var o,u,s=this.node;if(null!=this.diff&&(o=this._diff,this._diff=u=this.diff(this,this.data),null!=s)){var f=Ee(o)?a:i;if(o===u||f(o,u))return Q(this,s,e,t)}r&&A(this.hooks,"willRedraw",this,this.data);var d=this.render.call(this,this,this.data,o,u);if(d===s)return Q(this,s,e,t);if(this.refs=null,null!=this.key&&d.key!==this.key&&(d.key=this.key),this.node=d,e?(k(d,e,t,this),e.body[t]=d):s&&s.parent?(k(d,s.parent,s.idx,this),s.parent.body[s.idx]=d):k(d,null,null,this),!1!==n)if(s)if(s.tag!==d.tag||s.key!==d.key){s.vm=d.vm=null;var c=s.el.parentNode,h=N(s.el);C(c,s.el),L(c,W(d),h),s.el=d.el,d.vm=this}else J(d,s);else W(d);return r&&A(this.hooks,"didRedraw",this,this.data),l&&r&&T(this),l&&Se.mutations&&r&&console.log(We.end()),this},_redrawAsync:null,_updateAsync:null},Be="http://www.w3.org/2000/svg";te.prototype={constructor:te,type:pe,view:null,data:null,key:null,opts:null},ne.prototype={constructor:ne,type:me,vm:null};var Ke={config:function(e){Ve=e.onevent||Ve,e.onemit&&function(e){r(Ue,e)}(e.onemit),e.stream&&function(e){Ae=e.is,Te=e.val,Ne=e.sub,De=e.unsub}(e.stream)},ViewModel:Z,VNode:p,createView:P,defineElement:ee,defineSvgElement:function(e,t,n,l){var r=ee(e,t,n,l);return r.ns=Be,r},defineText:m,defineComment:function(e){var t=new p;return t.type=ye,t.body=e,t},defineView:function(e,t,n,l){return new te(e,t,n,l)},injectView:function(e){return new ne(e)},injectElement:function(e){var t=new p;return t.type=he,t.el=t.key=e,t},lazyList:function(e,t){var n=e.length,l={items:e,length:n,key:function(n){return t.key(e[n],n)},diff:function(n,l){var r=t.diff(e[n],n);if(null==l)return r;var o=l._diff;return(r===o||Ee(o)?a(r,o):i(r,o))||r},tpl:function(n){return t.tpl(e[n],n)},map:function(e){return t.tpl=e,l},body:function(e){for(var t=Array(n),r=0;r<n;r++){var o=l.tpl(r);o._diff=l.diff(r),t[r]=o,k(o,e,r)}e.body=t}};return l},FIXED_BODY:Le,DEEP_REMOVE:Me,KEYED_LIST:Ie,LAZY_LIST:Oe};xe.patch=function(e,t){!function(e,t,n){if(null!=t.type){if(null!=e.vm)return;k(t,e.parent,e.idx,null),e.parent.body[e.idx]=t,J(t,e),n&&c(t),T(y(t))}else{var l=Object.create(e);l.attrs=r({},e.attrs);var o=r(e.attrs,t);if(null!=e._class){var i=o.class;o.class=null!=i&&""!==i?e._class+" "+i:e._class}F(e,l),n&&c(e)}}(this,e,t)},ze.emit=function(e){var t=this,n=t,l=o(arguments,1).concat(n,n.data);do{var r=t.onemit,i=r?r[e]:null;if(i){i.apply(t,l);break}}while(t=t.parent());Ue[e]&&Ue[e].apply(t,l)},ze.onemit=null,ze.body=function(){return le(this.node,[])},Ke.defineElementSpread=re,Ke.defineSvgElementSpread=function(){var e=re.apply(null,arguments);return e.ns=Be,e},ze._stream=null;var Xe={area:!0,base:!0,br:!0,col:!0,command:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0},$e=".innerHTML";return ze.attach=function(e){return null==this.node&&this._redraw(null,null,!1),oe(this.node,e),this},ze.html=function(e){return null==this.node&&this._redraw(null,null,!1),ce(this.node,e)},xe.html=function(e){return ce(this,e)},Ke.DEVMODE=Se,Ke});